<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="member">

	<resultMap type="LC_003_1_VO" id="lc_getResult">
		<result property="lc_index" column="lc_index" />
		<result property="m_index" column="m_index" />
		<result property="lc_title" column="lc_title" />
		<result property="lc_type" column="lc_type" />
		<result property="lc_distance" column="lc_distance" />
		<result property="lc_run" column="lc_run" />
		<result property="lc_cycle" column="lc_cycle" />
		<result property="lc_area1" column="lc_area1" />
		<result property="lc_area2" column="lc_area2" />
		<result property="lc_area3" column="lc_area3" />
		<result property="lc_text" column="lc_text" jdbcType="CLOB"
			javaType="java.lang.String" />
		<result property="lc_date" column="lc_date" />
		<result property="lc_good" column="lc_good" />
		<result property="lc_see" column="lc_see" />
		<result property="lc_record" column="lc_record" />
		<result property="lc_address" column="lc_address" />
		<result property="lc_xy_arr" column="lc_xy_arr" jdbcType="CLOB"
			javaType="java.lang.String" />
	</resultMap>
	
	<resultMap id="clobThumbnail" type="java.util.HashMap">
		<result property="m_picture" column="m_picture" javaType="[B" jdbcType="BLOB"  />
	</resultMap>
	
	<resultMap id="request_thumbnail" type="vs.lo.lo_001.vo.LO_001_VO">
		<result property="m_index" column="m_index" />
		<result property="m_id" column="m_id" />
		<result property="m_pw" column="m_pw_1" />
		<result property="m_name" column="m_name" />
		<result property="m_gender" column="m_gender" />
		<result property="m_birth" column="m_birth" />
		<result property="m_email_1" column="m_email" />
		<result property="m_tel" column="m_tel" />
		<result property="m_address" column="m_address" />
		<result property="request_thumbnail" column="m_picture" />
		<result property="m_nickName" column="m_nickName" />
		<result property="m_state" column="m_state" />
		<result property="m_count" column="m_count" />
		<result property="m_point" column="m_point" />
	</resultMap>




	<select id="getMCList" resultType="vs.mp.mp_001.vo.MP_001_3_VO">
		<![CDATA[
			select 
				rownum rn,
                mp_index, lc_index, m_index,  lc_title, lc_type, lc_distance, 
				lc_run, lc_cycle, lc_area1, lc_area2, lc_area3, lc_thumbnail, 
				lc_text, lc_date, lc_good, lc_see, lc_record,
				lc_address, lc_xy_arr
                    from (
                    select rownum rn, mycourse.mp_index,mycourse.lc_index, 
                    	mycourse.m_index,  course.lc_title, course.lc_type, 
                    	course.lc_distance, 
						course.lc_run, course.lc_cycle, course.lc_area1, 
						course.lc_area2, course.lc_area3, 
						course.lc_thumbnail, 
						course.lc_text, course.lc_date, 
                        course.lc_good, 
                        course.lc_see, 
                        course.lc_record,
                        map.lc_address,
                        map.lc_xy_arr
                    from mycourse, course, map
                        where mycourse.lc_index = course.lc_index
                        and mycourse.lc_index = map.lc_index
                        and mycourse.m_index = #{m_index}
                        and rownum <= (#{page} * #{amount}))
                        where rn > ((#{page}-1) * #{amount})
				
		]]>
		<include refid="type_match"></include>
	</select>
	
	<insert id="get_member"
		parameterType="vs.ms.ms_001.vo.MS_001_VO">
		<![CDATA[
			INSERT INTO member 
			(m_index,
			m_id,
			m_pw_1,
			m_name,
			m_gender,
			m_birth,
			m_email,
			m_tel,
			m_address,
			m_nickname)
			
			
			VALUES (
			(select count(*) from member)+1,
			#{m_id},
			#{m_pw1},
			#{m_name},
			#{m_gender},
			#{m_birth},
			#{m_email_1},
			#{m_tel},
			#{m_address},
			#{m_nickName}
		)
		]]>
	</insert>
	
	<!-- 썸네일 업로드 -->
	<update id="set_member_thumbnail" parameterType="java.util.Map">
		  
		<selectKey keyProperty="m_index" order="BEFORE" resultType="String">
			<![CDATA[ 
				select count(*) from member
			]]>	
		</selectKey>
		
		<![CDATA[ 
			update member
			set m_picture = #{m_picture}
			where m_index = #{m_index}
		]]>	
	</update>
	
	<select id="idCheck" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*)
			FROM member
			WHERE
			M_ID = #{data}
		]]>
	</select>
	
	<select id="nickCheck" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*)
			FROM member
			WHERE
			M_NICKNAME = #{data}
		]]>
	</select>

	<select id="login" parameterType="vs.lo.lo_001.vo.LO_001_VO"
		resultType="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) FROM member 
			WHERE 
			M_ID = #{m_id}
			AND
			M_PW_1 = #{m_pw}
		]]>
	</select>
	

	<select id="getMemberList" resultMap="request_thumbnail">
		<![CDATA[
			SELECT 
			*
			FROM member
			WHERE 
			M_ID = #{m_id}
			AND
			M_PW_1 = #{m_pw}
		]]>
	</select>

	<select id="mc_paging_total" resultType="int">
		<![CDATA[
	        select 
				count(*)		
			from mycourse, course, map
				where mycourse.lc_index = course.lc_index
				and mycourse.lc_index = map.lc_index
				and mycourse.m_index = #{m_index}
		]]>
	</select>
	
	<!-- 나의기록 페이징 : 토탈 수 -->
	<select id="pagingDownPage" resultType="int">
		<![CDATA[
			select
				count(*)
			from
				mycourse, myrecord
				where mycourse.mp_index = myrecord.mp_index
				and mycourse.m_index = #{m_index}
				and mycourse.lc_index = #{lc_index}
		]]>
	</select>
	
	
	
	<!-- 
	<select id="getMyCourse" resultType="vs.mp.mp_001.vo.MP_001_3_VO">
		<![CDATA[
		select mp_index, lc_index, m_index
		from mycourse
		where m_index = #{m_index}
		and lc_index = #{lc_index}
		]]>
	</select>
	 -->
	 
		<select id="getMyCourseDetail" resultType="java.util.Map">
		<![CDATA[
			select
				rownum rn,
				pr_index,
				mycourse.mp_index,
				pr_title,
				pr_text,
				pr_see,
				pr_good,
				pr_resistDate,
				pr_recordDate,
				pr_record,
				pr_thumbnail,
				pr_type,
				pr_public
			from
				mycourse, myrecord
				where mycourse.mp_index = myrecord.mp_index
				and mycourse.m_index = #{m_index}
				and mycourse.lc_index = #{lc_index}
		]]>
	</select>
	
	
	

	<sql id="type_match">
		<trim prefix="AND (" suffix=")" prefixOverrides="OR">
			<trim prefix="OR">
				<choose>
					<when test="lc_type == '육상'">
						lc_type like '%'||#{lc_type}||'%'
					</when>
					<when test="lc_type == '자전거'">
						lc_type like '%'||#{lc_type}||'%'
					</when>
				</choose>
			</trim>
		</trim>
	</sql>
	
	<update id="memberUpdate"
		parameterType="vs.ms.ms_001.vo.MS_001_VO">
		<![CDATA[
			update member
			set
			m_pw_1 = #{m_pw1},
			m_name = #{m_name},
			m_email = #{m_email_1},
			m_tel = #{m_tel},
			m_address = #{m_address},
			m_nickname = #{m_nickName}
			
			where m_index = #{m_index}
			
		]]>
	</update>
	
		<!-- 썸네일 업데이트 -->
	<update id="update_member_thumbnail" parameterType="java.util.Map">
		  
		<![CDATA[ 
			update member
			set m_picture = #{m_picture}
			where m_index = #{m_index}
		]]>	
	</update>
	

</mapper>


  
  